<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>QR Code ç”¢ç”Ÿå™¨</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 1rem;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h2 {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }

    p {
      font-size: 1rem;
      font-weight: bold;
      color: red;
      text-align: center;
      margin-bottom: 1rem;
    }

    form {
      width: 100%;
      max-width: 500px;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    input, select, button {
      font-size: 1rem;
      padding: 0.5rem;
      width: 100%;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
/* === ç”Ÿæˆ QR Code æŒ‰éˆ•æ¨£å¼ï¼ˆå¦‚éœ€å¾®èª¿è«‹ä¿®æ”¹æ­¤å€å¡Šï¼‰ === */
    #barcodeForm button[type="button"] {
      width: auto;
      min-width: 200px;
      max-width: px;
      margin: 12px auto 0 auto;
      display: block;
      padding: 10px 0;
      font-size: 1rem;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      text-align: center;
    }

    /* === å…¨éƒ¨ä¸‹è¼‰æŒ‰éˆ•æ¨£å¼ï¼ˆå¦‚éœ€å¾®èª¿è«‹ä¿®æ”¹æ­¤å€å¡Šï¼‰ === */
    #downloadAllBtn {
      width: auto;
      min-width: 200px;
      max-width: 200px;
      margin: 12px auto 0 auto;
      display: block;
      padding: 10px 0;
      font-size: 1rem;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      text-align: center;
    }

    .qrcode-container {
      display: flex;
      flex-direction: column;   /* å‚ç›´æ’åˆ— */
      align-items: center;      /* ç½®ä¸­æ¯ä¸€å¼µ */
      gap: 1rem;
      width: 100%;
      max-width: 1000px;
      margin-top: 1rem;
    }

    .qr-wrapper {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      background-color: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .barcode-description {
      font-size: 0.9rem;
      line-height: 1.4;
      margin-top: 0.5rem;
      word-break: break-all;
    }

    @media screen and (max-width: 600px) {
      .qr-wrapper {
        width: 100%;
        align-items: center;
      }
    }
      
    #downloadAllBtn {  
      width: auto;
      min-width: 100px;
      max-width: 200px;
      margin: 12px auto 0 auto;
      display: block;
      padding: 10px 0;
      font-size: 1rem;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      text-align: center;
    }

    #mainContent {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
    <div id="loginBox">
      <h3>è«‹å…ˆç™»å…¥</h3>
      <input id="loginAccount" type="text" placeholder="å¸³è™Ÿ" />
      <input id="loginPassword" type="password" placeholder="å¯†ç¢¼" />
      <button onclick="login()">ç™»å…¥</button>
      <div id="loginMsg"></div>
    </div>

      <div id="mainApp" style="display: none;">
        <div id="mainContent" style="width:100%;max-width:500px;margin:0 auto;">
          <div style="text-align: center; line-height: 1.8;">
      <p style="margin-bottom: 0.0em;">ğŸš€ <strong>ä½¿ç”¨é¢¨éšªæé†’</strong></p>
      <p style="margin: 0;">ä¿¡ç”¨å¡æ¢ç¢¼ç”¢ç”Ÿå™¨æœ‰å¯èƒ½æœƒç™¼ç”Ÿ</p>
      <p style="margin: 0;">æ¢ç¢¼æƒå¾—éä½†å¯¦éš›æ²’å…¥å¸³</p>
      <p style="margin: 0;">ä»˜æ¬¾ç´€éŒ„ã€Œé£›åˆ°å¤–å¤ªç©ºã€ä¸è¦‹äº†çš„æƒ…æ³</p>
      <p style="margin: 0;">è«‹å‹™å¿…ç¢ºèªæ¢ç¢¼å…§å®¹æ­£ç¢ºç„¡èª¤</p>
      <p style="margin-top: 0.0em;">âš ï¸ é€™äº›é¢¨éšªéœ€ç”±æ‚¨è‡ªè¡Œæ‰¿æ“”ï¼Œè«‹å°å¿ƒä½¿ç”¨</p>
    </div>
    <h2>QR Code ç”¢ç”Ÿå™¨</h2>
    <form id="barcodeForm">
      <!-- ...åŸæœ¬è¡¨å–®å…§å®¹... -->
      <label>é¸æ“‡æ¢ç¢¼é¡å‹:</label>
      <select id="barcodeType">
        <option value="YYMM">å¹´+æœˆ</option>
        <option value="MMDD">æœˆ+æ—¥</option>
      </select>
      <label>ç¬¬ä¸€æ®µæ¢ç¢¼ (9ç¢¼)</label>
      <input type="text" id="firstBarcode" maxlength="9" pattern="[A-Za-z0-9]{9}" title="è«‹è¼¸å…¥ 9 ä½è‹±æ–‡æˆ–æ•¸å­—" required />
      <label>ç¬¬äºŒæ®µæ¢ç¢¼ (16ç¢¼)</label>
      <input type="text" id="secondBarcode" maxlength="16" pattern="[A-Za-z0-9]{16}" title="è«‹è¼¸å…¥ 16 ä½è‹±æ–‡æˆ–æ•¸å­—" required />
      <label>ç¹³è²»æœŸé™ (YYYMMDD)</label>
      <input type="text" id="paymentDue" maxlength="7" pattern="^[0-9]{7}$" title="è«‹è¼¸å…¥æ­£ç¢ºæ ¼å¼ï¼ˆYYYMMDDï¼‰" required />
      <label>ç¹³è²»é‡‘é¡</label>
      <input type="text" id="paymentAmount" pattern="^[0-9]+$" title="è«‹è¼¸å…¥æ•¸å­—é‡‘é¡" required />
      <label>ç”Ÿæˆ QR Code æ•¸é‡:</label>
      <select id="qrCount">
        <option value="1">1</option>
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="40">40</option>
        <option value="50">50</option>
      </select>
      <button type="button" onclick="generateQRCode()">ç”Ÿæˆ QR Code</button>
    </form>
    <button type="button" id="downloadAllBtn" style="display:none;">å…¨éƒ¨ä¸‹è¼‰</button>
  </div>
  <div class="qrcode-container" id="qrcodeContainer" style="display: none;"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script>
  // å­—æ¯è½‰æ•¸å­—
  function convertLettersToNumbers(text) {
    var result = "";
    for (var i = 0; i < text.length; i++) {
      var char = text.charAt(i);
      if (char >= 'A' && char <= 'Z') {
        result += convertLetterToNumber(char);
      } else if (!isNaN(char)) {
        result += char;
      }
    }
    return result;
  }
  function convertLetterToNumber(letter) {
    var mapping = {
      'A': '1', 'B': '2', 'C': '3', 'D': '4', 'E': '5',
      'F': '6', 'G': '7', 'H': '8', 'I': '9', 'J': '1',
      'K': '2', 'L': '3', 'M': '4', 'N': '5', 'O': '6',
      'P': '7', 'Q': '8', 'R': '9', 'S': '2', 'T': '3',
      'U': '4', 'V': '5', 'W': '6', 'X': '7', 'Y': '8', 'Z': '9'
    };
    return mapping[letter] || '0';
  }
  function calculateOddSum(barcode) {
    var sum = 0;
    for (var i = 0; i < barcode.length; i += 2) {
      var char = barcode.charAt(i);
      if (!isNaN(char)) {
        sum += parseInt(char, 10);
      }
    }
    return sum;
  }
  function calculateEvenSum(barcode) {
    var sum = 0;
    for (var i = 1; i < barcode.length; i += 2) {
      var char = barcode.charAt(i);
      if (!isNaN(char)) {
        sum += parseInt(char, 10);
      }
    }
    return sum;
  }
  function isValidMinguoDate(date) {
    if (!/^[0-9]{7}$/.test(date)) return false;
    const year = parseInt(date.substring(0, 3), 10) + 1911;
    const month = parseInt(date.substring(3, 5), 10);
    const day = parseInt(date.substring(5, 7), 10);
    if (month < 1 || month > 12) return false;
    const daysInMonth = new Date(year, month, 0).getDate();
    return day >= 1 && day <= daysInMonth;
  }

  function generateQRCode() {
    const firstBarcode = document.getElementById("firstBarcode").value.trim();
    const secondBarcode = document.getElementById("secondBarcode").value.trim();
    const paymentDue = document.getElementById("paymentDue").value.trim();
    const paymentAmount = document.getElementById("paymentAmount").value.trim();
    const barcodeType = document.getElementById("barcodeType").value;
    const qrCount = parseInt(document.getElementById("qrCount").value);

    if (!firstBarcode || !secondBarcode || !paymentDue || !paymentAmount || isNaN(qrCount)) {
      alert("è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼");
      return;
    }
    if (!isValidMinguoDate(paymentDue)) {
      alert("ç¹³è²»æœŸé™æ ¼å¼éŒ¯èª¤ï¼Œè«‹è¼¸å…¥æ­£ç¢ºçš„æ°‘åœ‹æ—¥æœŸ\n(YYYMMDD)");
      return;
    }

    const container = document.getElementById("qrcodeContainer");
    container.innerHTML = "";
    container.style.display = "flex";
    container.style.flexWrap = "wrap";
    container.style.justifyContent = "center";

    let currentDate = new Date(
      parseInt(paymentDue.substring(0, 3), 10) + 1911,
      parseInt(paymentDue.substring(3, 5), 10) - 1,
      parseInt(paymentDue.substring(5, 7), 10)
    );

    for (let i = 0; i < qrCount; i++) {
      let formattedDate;
      if (barcodeType === "YYMM") {
        if (i === 0) {
          formattedDate = paymentDue;
        } else {
          currentDate.setMonth(currentDate.getMonth() + 1);
          formattedDate =
            `${String(currentDate.getFullYear() - 1911).padStart(3, "0")}${String(currentDate.getMonth() + 1).padStart(2, "0")}01`;
        }
      } else {
        formattedDate =
          `${String(currentDate.getFullYear() - 1911).padStart(3, "0")}${String(currentDate.getMonth() + 1).padStart(2, "0")}${String(currentDate.getDate()).padStart(2, "0")}`;
        currentDate.setDate(currentDate.getDate() + 1);
      }

      const convertedFirst = convertLettersToNumbers(firstBarcode);
      const convertedSecond = convertLettersToNumbers(secondBarcode);
      const datePart = barcodeType === "YYMM" ? formattedDate.substring(1, 5) : formattedDate.substring(3);
      const paddedAmount = paymentAmount.padStart(9, "0");

      const oddSum = calculateOddSum(convertedFirst) + calculateOddSum(convertedSecond) + calculateOddSum(datePart + paddedAmount);
      const evenSum = calculateEvenSum(convertedFirst) + calculateEvenSum(convertedSecond) + calculateEvenSum(datePart + paddedAmount);

      const oddChecksum = oddSum % 11 === 0 ? "A" : oddSum % 11 === 10 ? "B" : oddSum % 11;
      const evenChecksum = evenSum % 11 === 0 ? "X" : evenSum % 11 === 10 ? "Y" : evenSum % 11;

      const thirdBarcode = datePart + oddChecksum + evenChecksum + paddedAmount;
      const qrData = `FAMI||{"bar1":"${firstBarcode}","bar2":"${secondBarcode}","bar3":"${thirdBarcode}","ID":"3A01"}`;

       // --- æ¢ç¢¼å€å¡Š ---
     const wrapper = document.createElement("div");
     wrapper.className = "qr-wrapper";
     wrapper.style.border = "1px solid #ccc";
     wrapper.style.borderRadius = "12px";
     wrapper.style.padding = "16px 12px 12px 12px"; // ä¸Šæ–¹ç©ºç™½ç¸®çŸ­
     wrapper.style.margin = "12px";
     wrapper.style.backgroundColor = "#fff";
     wrapper.style.maxWidth = "320px";
     wrapper.style.width = "100%";
     wrapper.style.position = "relative";
     wrapper.style.boxSizing = "border-box";

            // æ¨™é¡Œèˆ‡æµæ°´è™ŸåŒä¸€è¡Œ
            const titleRow = document.createElement("div");
            titleRow.style.display = "flex";
            titleRow.style.justifyContent = "center";
            titleRow.style.alignItems = "center";
            titleRow.style.width = "100%";
            titleRow.style.marginBottom = "10px";
            titleRow.style.position = "relative";

            const title = document.createElement("div");
            title.textContent = "ç¹³æ¬¾æ¢ç¢¼";
            title.style.fontWeight = "bold";
            title.style.fontSize = "20px";
            title.style.letterSpacing = "2px";
            title.style.textAlign = "center";
            title.style.flex = "1";

            const serialNumber = document.createElement("div");
            serialNumber.textContent = (i + 1);
            serialNumber.style.position = "absolute";
            serialNumber.style.right = "0";
            serialNumber.style.top = "0";
            serialNumber.style.fontWeight = "bold";
            serialNumber.style.fontSize = "16px";
            serialNumber.style.color = "#888";

            titleRow.appendChild(title);
            titleRow.appendChild(serialNumber);
            wrapper.appendChild(titleRow);

      // QR Code
      const qrDiv = document.createElement("div");
      qrDiv.style.margin = "0 auto";
      qrDiv.style.alignSelf = "center";
      qrDiv.style.width = "150px"; // å›ºå®šå¯¬åº¦ï¼Œæ–¹ä¾¿å°é½Š
      qrDiv.style.position = "relative";
      new QRCode(qrDiv, { text: qrData, width: 150, height: 150 });
      wrapper.appendChild(qrDiv);

      // ä¸‰æ®µæ¢ç¢¼ç´”æ–‡å­—é¡¯ç¤ºï¼ˆåƒ…ç•«é¢ç”¨ï¼Œä¸‹è¼‰æ™‚ä¸è¦åŠ ï¼‰
      const barcodeTextDiv = document.createElement("div");
      barcodeTextDiv.style.display = "block";
      barcodeTextDiv.style.margin = "8px 0 0 0"; // ç·Šè²¼QRä¸‹æ–¹
      barcodeTextDiv.style.fontSize = "16px";
      barcodeTextDiv.style.letterSpacing = "2px";
      barcodeTextDiv.style.textAlign = "left";
      barcodeTextDiv.style.lineHeight = "1.6";
      barcodeTextDiv.style.width = "150px"; // èˆ‡ QR Code å¯¬åº¦ä¸€è‡´
      barcodeTextDiv.style.position = "relative";
      barcodeTextDiv.style.left = "50%";
      barcodeTextDiv.style.transform = "translateX(-50%)"; // è®“æ¢ç¢¼å€å¡Šèˆ‡ QR Code å·¦å´é½Š
      barcodeTextDiv.innerHTML = `
        <div>${firstBarcode}</div>
        <div>${secondBarcode}</div>
        <div>${thirdBarcode}</div>
      `;
      wrapper.appendChild(barcodeTextDiv);

      // ä¸‹è¼‰æŒ‰éˆ•
      const downloadRow = document.createElement("div");
      downloadRow.className = "download-row";
      downloadRow.style.width = "100%";
      downloadRow.style.display = "flex";
      downloadRow.style.justifyContent = "flex-end";
      const downloadBtn = document.createElement("button");
      downloadBtn.textContent = "ä¸‹è¼‰";
      downloadBtn.className = "download-btn";
      downloadBtn.style.marginTop = "8px";
      downloadBtn.style.padding = "6px 18px";
      downloadBtn.style.fontSize = "15px";
      downloadBtn.style.borderRadius = "5px";
      downloadBtn.style.backgroundColor = "#4CAF50";
      downloadBtn.style.color = "white";
      downloadBtn.style.border = "none";
      downloadBtn.style.cursor = "pointer";
      downloadBtn.style.width = "80px"; // æŒ‰éˆ•å¯¬åº¦ç¸®çŸ­
      downloadBtn.onclick = () => {
        const cleanWrapper = document.createElement("div");
        cleanWrapper.style.display = "flex";
        cleanWrapper.style.flexDirection = "column";
        cleanWrapper.style.alignItems = "center";
        cleanWrapper.style.padding = "16px 12px 12px 12px";
        cleanWrapper.style.border = "1px solid #ccc";
        cleanWrapper.style.borderRadius = "12px";
        cleanWrapper.style.backgroundColor = "#fff";
        cleanWrapper.style.maxWidth = "320px";
        cleanWrapper.style.width = "100%";
        cleanWrapper.style.position = "relative";
        cleanWrapper.style.boxSizing = "border-box";

        // æ¨™é¡Œèˆ‡æµæ°´è™ŸåŒä¸€è¡Œï¼ˆç½®ä¸­ï¼‰
        const titleRow = document.createElement("div");
        titleRow.style.display = "flex";
        titleRow.style.justifyContent = "center";
        titleRow.style.alignItems = "center";
        titleRow.style.width = "100%";
        titleRow.style.marginBottom = "10px";
        titleRow.style.position = "relative";

        const titleClone = document.createElement("div");
        titleClone.textContent = "ç¹³æ¬¾æ¢ç¢¼";
        titleClone.style.fontWeight = "bold";
        titleClone.style.fontSize = "20px";
        titleClone.style.letterSpacing = "2px";
        titleClone.style.textAlign = "center";
        titleClone.style.flex = "1";

        const serialNumberClone = document.createElement("div");
        serialNumberClone.textContent = serialNumber.textContent;
        serialNumberClone.style.position = "absolute";
        serialNumberClone.style.right = "0";
        serialNumberClone.style.top = "0";
        serialNumberClone.style.fontWeight = "bold";
        serialNumberClone.style.fontSize = "16px";
        serialNumberClone.style.color = "#888";

        titleRow.appendChild(titleClone);
        titleRow.appendChild(serialNumberClone);
        cleanWrapper.appendChild(titleRow);

        // QR Code
        const qrDivClone = document.createElement("div");
        qrDivClone.style.margin = "0 auto";
        qrDivClone.style.alignSelf = "center";
        new QRCode(qrDivClone, { text: qrData, width: 150, height: 150 });
        cleanWrapper.appendChild(qrDivClone);

        const tempContainer = document.createElement("div");
        tempContainer.style.position = "fixed";
        tempContainer.style.left = "-9999px";
        document.body.appendChild(tempContainer);
        tempContainer.appendChild(cleanWrapper);

        html2canvas(cleanWrapper, { scale: 2 }).then(canvas => {
          const link = document.createElement("a");
          link.download = `ç¹³æ¬¾å¸³å–®_${serialNumber.textContent}.png`;
          link.href = canvas.toDataURL("image/png");
          link.click();
          document.body.removeChild(tempContainer);
        });
      };
      downloadRow.appendChild(downloadBtn);
      wrapper.appendChild(downloadRow);

      container.appendChild(wrapper);
    }

    // é¡¯ç¤ºå…¨éƒ¨ä¸‹è¼‰æŒ‰éˆ•ï¼ˆå¤šå¼µæ‰é¡¯ç¤ºï¼‰
    document.getElementById("downloadAllBtn").style.display = qrCount > 1 ? "inline-block" : "none";
    document.getElementById("downloadAllBtn").onclick = async function() {
      const zip = new JSZip();
      const wrappers = document.querySelectorAll(".qr-wrapper");
      let hasData = false;

      for (let idx = 0; idx < wrappers.length; idx++) {
        // å–å¾—æ¯å¼µçš„ QR è³‡æ–™
        const qrData = wrappers[idx].querySelector("canvas") ? wrappers[idx].querySelector("canvas").getAttribute("data-qrcode") : null;
        // å–å¾—æµæ°´è™Ÿ
        const serialNumber = wrappers[idx].querySelector("div[style*='position: absolute']")?.textContent || (idx + 1);

        // çµ„è£ä¹¾æ·¨å€å¡Šï¼ˆèˆ‡å–®å¼µä¸‹è¼‰ä¸€è‡´ï¼‰
        const cleanWrapper = document.createElement("div");
        cleanWrapper.style.display = "flex";
        cleanWrapper.style.flexDirection = "column";
        cleanWrapper.style.alignItems = "center";
        cleanWrapper.style.padding = "16px 12px 12px 12px";
        cleanWrapper.style.border = "1px solid #ccc";
        cleanWrapper.style.borderRadius = "12px";
        cleanWrapper.style.backgroundColor = "#fff";
        cleanWrapper.style.maxWidth = "320px";
        cleanWrapper.style.width = "100%";
        cleanWrapper.style.position = "relative";
        cleanWrapper.style.boxSizing = "border-box";

        // æ¨™é¡Œèˆ‡æµæ°´è™ŸåŒä¸€è¡Œï¼ˆç½®ä¸­ï¼‰
        const titleRow = document.createElement("div");
        titleRow.style.display = "flex";
        titleRow.style.justifyContent = "center";
        titleRow.style.alignItems = "center";
        titleRow.style.width = "100%";
        titleRow.style.marginBottom = "10px";
        titleRow.style.position = "relative";

        const titleClone = document.createElement("div");
        titleClone.textContent = "ç¹³æ¬¾æ¢ç¢¼";
        titleClone.style.fontWeight = "bold";
        titleClone.style.fontSize = "20px";
        titleClone.style.letterSpacing = "2px";
        titleClone.style.textAlign = "center";
        titleClone.style.flex = "1";

        const serialNumberClone = document.createElement("div");
        serialNumberClone.textContent = serialNumber;
        serialNumberClone.style.position = "absolute";
        serialNumberClone.style.right = "0";
        serialNumberClone.style.top = "0";
        serialNumberClone.style.fontWeight = "bold";
        serialNumberClone.style.fontSize = "16px";
        serialNumberClone.style.color = "#888";

        titleRow.appendChild(titleClone);
        titleRow.appendChild(serialNumberClone);
        cleanWrapper.appendChild(titleRow);

        // QR Code
        const qrDivClone = document.createElement("div");
        qrDivClone.style.margin = "0 auto";
        qrDivClone.style.alignSelf = "center";
        // é‡æ–°ç”¢ç”Ÿ QR Codeï¼ˆè«‹æ ¹æ“šä½ çš„è³‡æ–™ä¾†æºå¡«å…¥ qrDataï¼‰
        // è‹¥ qrData å–ä¸åˆ°ï¼Œè«‹ç”¨ä½ åŸæœ¬ç”¢ç”Ÿ QR Code çš„è³‡æ–™çµ„è£æ–¹å¼
        new QRCode(qrDivClone, { text: wrappers[idx].getAttribute("data-qrcode") || qrData || "QRè³‡æ–™", width: 150, height: 150 });
        cleanWrapper.appendChild(qrDivClone);

        const tempContainer = document.createElement("div");
        tempContainer.style.position = "fixed";
        tempContainer.style.left = "-9999px";
        document.body.appendChild(tempContainer);
        tempContainer.appendChild(cleanWrapper);

        const canvas = await html2canvas(cleanWrapper, { scale: 2 });
        const dataUrl = canvas.toDataURL("image/png");
        const base64 = dataUrl.split(',')[1];
        if (base64.length > 100) {
          zip.file(`ç¹³æ¬¾å¸³å–®_${serialNumber}.png`, base64, {base64: true});
          hasData = true;
        }
        document.body.removeChild(tempContainer);
      }

      if (!hasData) {
        alert("æ²’æœ‰å¯ä¸‹è¼‰çš„æ¢ç¢¼åœ–ç‰‡ï¼");
        return;
      }

      zip.generateAsync({type:"blob"}).then(function(content) {
        saveAs(content, "ä¿¡ç”¨å¡å¸³å–®.zip");
      });
    };
  }

    // è«‹åœ¨ <script> è£¡åŠ ä¸Šé€™æ®µ
    function showCustomAlert(msg) {
        document.getElementById('customAlertMsg').innerText = msg;
        document.getElementById('customAlert').style.display = 'flex';
    }

    function login() {
      const account = document.getElementById('loginAccount').value.trim();
      const password = document.getElementById('loginPassword').value.trim();

      google.script.run
        .withSuccessHandler(function(response) {
          if (response === true) {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
          } else {
            document.getElementById('loginMsg').innerText = 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤';
          }
        })
        .withFailureHandler(function(error) {
          document.getElementById('loginMsg').innerText = 'ç™»å…¥æœå‹™éŒ¯èª¤ï¼š' + error.message;
        })
        .checkLogin(account, password);
    }
  </script>
</body>
</html>
